@inject IInterestService InterestService
@inject IAuthService AuthService

<MudText Typo="Typo.h6">Delete interest</MudText>

<MudTable Items="@Interests" Hover="true" Breakpoint="Breakpoint.Sm">
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Delete Interest</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Sign">@context.Name</MudTd>
        <MudTd DataLabel="Delete Interest">
            <MudIconButton @onclick="(() => DeleteInterestFromDb(context.Id))" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" aria-label="delete"></MudIconButton>
        </MudTd>
    </RowTemplate>
</MudTable>


@code {
    [Parameter]
    public EventCallback RefreshInterests { get; set; }
    public int InterestId { get; set; }
    private UserAuth User { get; set; }

    private List<InterestModel> Interests { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        User = await AuthService.GetUser();
        await GetInterestsByRole();

    }

    public async Task DeleteInterestFromDb(int id)
    {
        InterestDeleteDto interestToDelete = new InterestDeleteDto
            {
                Id = id
            };

        await InterestService.DeleteInterest(interestToDelete);
        await InvokeRefreshInterests();
    }

    private async Task GetInterestsByRole()
    {
        if (await AuthService.IsAdmin())
        {
            await InterestService.GetInterests();
            Interests = InterestService.Interests;
        }
        else
        {
            Interests = await InterestService.GetUserCreatedInterests(User.Id);
        }
    }

    private async Task InvokeRefreshInterests()
    { 
        await RefreshInterests.InvokeAsync();
        await GetInterestsByRole();
    } 
}
